YUI.add("gallery-sm-editor-link",function(e,t){(function(){var t=e.Editor.DOM,n=e.Base.create("editorLink",e.Base,[],{linkCommands:{createLink:{fn:"_createLink"},unlink:{fn:"_unlink"}},linkKeyCommands:{"alt+ctrl+l":{fn:"_linkPrompt",allowDefault:!1}},linkTags:"a",linkTemplate:'<a href="{href}" target="{target}"></a>',initializer:function(){this.supportedTags?this.supportedTags+=","+this.linkTags:this.supportedTags=this.linkTags,this.keyCommands&&(this.keyCommands=e.merge(this.keyCommands,this.linkKeyCommands)),this._attachLinkEvents()},destructor:function(){this._detachLinkEvents()},isLink:function(){return!!this._getAnchorNode()},_attachLinkEvents:function(){if(this._linkEvents)return;this._linkEvents=[e.Do.before(this._linkBeforeExecCommand,this,"_execCommand",this)]},_detachLinkEvents:function(){this._linkEvents&&((new e.EventHandle(this._linkEvents)).detach(),this._linkEvents=null)},_execLinkCommand:function(e,t){var n=this.linkCommands[e],r=this.selection.range(),i;if(!r||!n)return;i=n.fn,"string"==typeof i&&(i=this[i]),i&&i.call(this,t)},_getAnchorNode:function(){this.focus();var e=this.selection.range().shrink().parentNode();return e.ancestor(this.linkTags,!0)},_createLink:function(t){var n=this.selection.range(),r,i;if(!n)return;this.isLink()&&(this._unlink(),n=this.selection.range()),t||(t={}),t.target||(t.target="_self"),t.href||(t.href=""),r=e.Node.create(e.Lang.sub(this.linkTemplate,t)),i=this._getStyleNodes(n),r.append(i),n.insertNode(r);if(t.text&&t.text!==n.toString()){var s=r.get("firstChild");this._isStyleNode(s)?(s.set("text",t.text),r.setHTML(s)):r.set("text",t.text)}n.selectNode(r).collapse(),this.selection.select(n)},_linkPrompt:function(){var t=e.config.win.prompt("Enter a url");t&&this.command("createLink",{href:t})},_unlink:function(){var e=this._getAnchorNode(),n;e&&(n=t.unwrap(e),this.selection.select(n.shrink({trim:!0})))},_linkBeforeExecCommand:function(t,n){if(this.linkCommands[t]){var r=this._execLinkCommand(t,n);return new e.Do.Halt("Editor.Link prevented _execCommand",r)}}});e.namespace("Editor").Link=n})()},"@VERSION@",{requires:["gallery-sm-editor-base","gallery-sm-editor-dom"]});
