YUI.add("gallery-sm-editor-style",function(e,t){(function(){var t=e.config.doc,n=e.Editor.DOM,r="<span></span>",i=e.Base.create("editorStyle",e.Base,[],{styleCommands:{bold:{commandFn:"_execStyleCommand",queryFn:"_queryStyleCommand",style:{property:"fontWeight",value:"bold"}},fontName:{commandFn:"_execStyleCommand",queryFn:"_queryStyleCommand",style:{property:"fontFamily"}},fontSize:{commandFn:"_execStyleCommand",queryFn:"_queryStyleCommand",style:{property:"fontSize"}},italic:{commandFn:"_execStyleCommand",queryFn:"_queryStyleCommand",style:{property:"fontStyle",value:"italic"}},justifyCenter:{commandFn:"_execStyleCommand",queryFn:"_queryStyleCommand",style:{property:"textAlign",value:"center"},type:"block"},justifyFull:{commandFn:"_execStyleCommand",queryFn:"_queryStyleCommand",style:{property:"textAlign",value:"justify"},type:"block"},justifyLeft:{commandFn:"_execStyleCommand",queryFn:"_queryStyleCommand",style:{property:"textAlign",value:""},type:"block"},justifyRight:{commandFn:"_execStyleCommand",queryFn:"_queryStyleCommand",style:{property:"textAlign",value:"right"},type:"block"},strikeThrough:{commandFn:"_execStyleCommand",queryFn:"_queryStyleCommand",style:{property:"textDecoration",value:"line-through"}},underline:{commandFn:"_execStyleCommand",queryFn:"_queryStyleCommand",style:{property:"textDecoration",value:"underline"}}},styleKeyCommands:{"ctrl+b":"bold","ctrl+i":"italic","ctrl+u":"underline"},styleTags:"span",initializer:function(){this.commands=e.merge(this.commands,this.styleCommands),this.supportedTags?this.supportedTags+=","+this.styleTags:this.supportedTags=this.styleTags,this.supportedStyles=[],e.Object.each(this.styleCommands,function(e){this.supportedStyles.push(e.style.property)},this),this.keyCommands&&(this.keyCommands=e.merge(this.keyCommands,this.styleKeyCommands))},styles:function(e){var t={},n;if(e)for(n in e)e.hasOwnProperty(n)&&(t[n]=this.command(n,e[n]));else{var r=this.styleCommands;for(n in r)r.hasOwnProperty(n)&&(t[n]=this.query(n))}return t},_execStyleCommand:function(t,n){var r=this.commands[t],i=this.selection.range(),s,o;if(!i||!r||!r.style)return;"block"===r.type?s=this._getNodes(i,this.blockTags):s=this._getStyleNodes(i),o=s.item(0)._node.style[r.style.property],e.Lang.isValue(r.style.value)?o&&o===r.style.value?o="":o=r.style.value:n?o=r.style.value||n:o="",s.setStyle(r.style.property,o),"block"!==r.type&&(i.startNode(s.item(0)),i.endNode(s.item(s.size()-1),"after"),this.selection.select(i.shrink()))},_formatHTML:function(i){function s(t){var i=t.get("childNodes")._nodes;e.Array.each(i.reverse(),function(t){var i;t=e.one(t),i=t.get("parentNode"),n.isTextNode(t)?this._isBlockNode(i)?t.wrap(r):t.get("previousSibling")&&n.split(i,t):(t.test(this.supportedTags)?!this._isBlockNode(i)&&!i.test("a")&&(i.insert(t,"after"),this._isBlockNode(t)||(t.addClass(i.get("className")),n.copyStyles(i,t,this.supportedStyles,{explicit:!0,overwrite:!1}))):t.replace(t.get("text")),s.call(this,t),n.isEmptyNode(t)&&t.remove(!0),t.removeAttribute("id"))},this)}var o=e.one(t.createDocumentFragment()).setHTML(i);return s.call(this,o),o},_getHTML:function(t){return t=e.Editor.Base.prototype._getHTML.call(this,t),this.get("formatFn")(t).getHTML()},_getStyleNodes:function(t){var i,s=[];t.shrink(),i=t.parentNode().ancestor(this.styleTags,!0,this.selectors.input);if(i){if(t.toString()===i.get("text"))return new e.NodeList([i])}else i=e.Node.create(r);var o=t.startNode(),u=t.startOffset(),a=t.endNode(),f=t.endOffset();return t.traverse(function(e){if(!n.isTextNode(e))return;a===e&&f!==n.maxOffset(a)&&(e=n.split(e,f).get("previousSibling")),o===e&&u&&(e=n.split(e,u)),this._isStyleNode(e.get("parentNode"))?(e.get("nextSibling")&&n.split(e.get("parentNode"),e.get("nextSibling")),e.get("previousSibling")&&n.split(e.get("parentNode"),e),s.push(e.get("parentNode"))):s.push(e.wrap(i).get("parentNode"))},this),new e.NodeList(s)},_isBlockNode:function(t){return t=e.one(t),!n.isTextNode(t)&&(t.get("nodeName")==="#document-fragment"||t.test(this.blockTags))},_isStyleNode:function(t){return t=e.one(t),t&&!n.isTextNode(t)&&t.test(this.styleTags)},_setHTML:function(t){return t=this.get("formatFn")(t).getHTML(),e.Editor.Base.prototype._setHTML.call(this,t)},_queryStyleCommand:function(t){var n=this.commands[t],r=this.selection.range().clone(),i="span",s=[],o;return r&&n.style&&("block"===n.type&&(i=this.blockTags),this._getNodes(r,i).each(function(e){var t;n.style.computed?t=e.getStyle(n.style.property):t=e._node.style[n.style.property],s.push(t||"")}),s=e.Array.dedupe(s),1===s.length&&(o=s[0]),e.Lang.isValue(n.style.value)?o=o==n.style.value:""===o&&(o=null)),o}},{ATTRS:{formatFn:{readOnly:!0,setter:function(t){return e.bind(t,this)},validator:e.Lang.isFunction,valueFn:function(){return this._formatHTML}}}});e.namespace("Editor").Style=i})()},"@VERSION@",{requires:["gallery-sm-editor-base","gallery-sm-editor-dom","gallery-sm-editor-keys","gallery-sm-editor-queue","node-style"]});
