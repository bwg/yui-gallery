YUI.add("gallery-sm-editor-block",function(e,t){(function(){var t=e.Editor.DOM,n=e.Base.create("editorBlock",e.Base,[],{blockCommands:{"delete":{commandFn:"_delete"},forwardDelete:{commandFn:"_forwardDelete"},formatBlock:{commandFn:"_formatBlock",queryFn:"_queryBlockCommand"},heading:{commandFn:"_formatBlock",queryFn:"_queryBlockCommand"},insertBreak:{commandFn:"_insertBreak"},insertParagraph:{commandFn:"_insertReturn",queryFn:"_queryBlockCommand"}},blockKeyCommands:{"alt+c":"justifyCenter","alt+f":"justifyFull","alt+l":"justifyLeft","alt+r":"justifyRight",backspace:"delete","delete":"forwardDelete",enter:"insertParagraph","shift+enter":"insertBreak"},blockTags:"div, p, h1, h2, h3, h4, h5",initializer:function(){this.commands=e.merge(this.commands,this.blockCommands),this.supportedTags?this.supportedTags+=","+this.blockTags:this.supportedTags=this.blockTags,this.keyCommands&&(this.keyCommands=e.merge(this.keyCommands,this.blockKeyCommands)),this._attachBlockEvents()},destructor:function(){this._detachBlockEvents()},_attachBlockEvents:function(){if(this._blockEvents)return;this._blockEvents=[this.on("selectionChange",this._blockOnSelectionChange,this)]},_delete:function(e){var t=this.selection,n=t.range(),r,i;e="forward"===e?"end":"start",n.deleteContents(),n.parentNode()===this._inputNode?(r=this._inputNode.get("childNodes").item(n.startOffset()),"end"===e&&(r=r&&r.previous()),r&&n.selectNodeContents(r).collapse({toStart:"start"===e})):r=this._getNodes(n,this.blockTags).item(0);if(this._inputNode.contains(r)){n.expand({stopAt:r}),i=n.clone().selectNodeContents(r).collapse({toStart:"start"===e});if(0===n.compare(i,{myPoint:e,otherPoint:e})){var s,o,u,a;e==="start"?(s=r,o=r.previous()):(s=r.next(),o=r),s&&o&&(u=s.get("childNodes"),a=u.item(0),o.append(u),s.remove(!0),n.startNode(a,0))}else"start"===e?this._execCommand("delete"):this._execCommand("forwardDelete");n.collapse({toStart:!0})}t.select(n)},_detachBlockEvents:function(){this._blockEvents&&((new e.EventHandle(this._blockEvents)).detach(),this._blockEvents=null)},_formatBlock:function(n){n=n.replace(/[<>]/g,"");if(-1<this.blockTags.indexOf(n)){n="<"+n+">";var r=this.selection,i=r.range(),s=[];this._getNodes(i,this.blockTags).each(function(r){var i=e.Node.create(n);i.insert(r.get("childNodes")),t.copyStyles(r,i,this.supportedStyles,{explicit:!0,overwrite:!1}),r.replace(i).remove(!0),s.push(i)},this),i.startNode(s[0]),i.endNode(s[s.length]),console.log("shrink in formatblock"),i.shrink().collapse({toStart:!0}),r.select(i)}},_forwardDelete:function(){return this._delete("forward")},_insertBreak:function(){var e=this._insertHTML("<br>");(!e.get("nextSibling")||""===e.get("nextSibling").get("text"))&&this._insertHTML("<br>")},_insertReturn:function(){var e=this.selection,n=e.range().shrink(),r,i,s;n.deleteContents(),r=this._getNodes(n,this.blockTags).item(0),""===r.get("text")&&n.selectNodeContents(r).collapse(),n.expand({stopAt:r}),i=n.clone().selectNodeContents(r).collapse({toStart:!0}),s=n.clone().selectNodeContents(r).collapse(),0===n.compare(i,{myPoint:"start",otherPoint:"start"})?r=r.insert(r.cloneNode(),"before").previous():0===n.compare(s,{myPoint:"end",otherPoint:"end"})?r=r.insert("<p></p>","after").next():r=this._splitRange(n,this.blockTags),t.isEmptyNode(r)&&r.setHTML("<br>"),n.selectNodeContents(r).collapse({toStart:!0}),e.select(n)},_queryBlockCommand:function(){return this._getNodes(this.selection.range(),this.blockTags)},_splitRange:function(e,n){var r,i;r=e.endNode(),i=e.endOffset();while(!r.test(n))i=t.split(r,i),r=i.get("parentNode");return this._inputNode!==r&&(i=t.split(r,i),r=i.get("parentNode")),i._node||(i=r.get("childNodes").item(i)),i},_blockOnSelectionChange:function(t){var n=t.range,r;if(!n||!n.isCollapsed())return;r=n.startNode(),this._inputNode===r.ancestor(this.blockTags,!0)&&e.Editor.Base.prototype._execCommand.call(this,"formatBlock","<p>")}});e.namespace("Editor").Block=n})()},"@VERSION@",{requires:["gallery-sm-editor-base","gallery-sm-editor-dom","gallery-sm-editor-keys","node-style"]});
